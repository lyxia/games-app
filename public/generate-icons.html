<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA å›¾æ ‡ç”Ÿæˆå™¨</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      margin: 30px 0;
    }

    .preview-item {
      text-align: center;
    }

    .preview-item canvas {
      width: 100%;
      height: auto;
      border-radius: 20%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }

    .preview-item canvas:hover {
      transform: scale(1.05);
    }

    .preview-item span {
      display: block;
      margin-top: 8px;
      font-size: 12px;
      color: #666;
    }

    .button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .button:active {
      transform: translateY(0);
    }

    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      background: #f0f0f0;
      font-size: 14px;
      color: #333;
      text-align: center;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
    }

    .instructions {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 14px;
      line-height: 1.6;
      color: #555;
    }

    .instructions ol {
      margin-left: 20px;
      margin-top: 10px;
    }

    .instructions li {
      margin: 8px 0;
    }

    code {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .upload-area {
      border: 2px dashed #667eea;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      margin-bottom: 20px;
      background: #f8f9ff;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-area:hover {
      border-color: #764ba2;
      background: #f0f2ff;
    }

    .upload-area.drag-over {
      border-color: #38ef7d;
      background: #e8fff3;
    }

    .upload-area input {
      display: none;
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .upload-text {
      color: #667eea;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .upload-hint {
      color: #999;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ® PWA å›¾æ ‡ç”Ÿæˆå™¨</h1>
    <p class="subtitle">ä¸Šä¼  SVG æ–‡ä»¶ï¼Œç”Ÿæˆæ‰€æœ‰å°ºå¯¸çš„ PWA å›¾æ ‡</p>

    <div class="upload-area" id="uploadArea" onclick="document.getElementById('svgInput').click()">
      <input type="file" id="svgInput" accept=".svg,image/svg+xml" onchange="handleFileUpload(event)">
      <div class="upload-icon">ğŸ“¤</div>
      <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼  SVG æ–‡ä»¶</div>
      <div class="upload-hint">æ”¯æŒ .svg æ ¼å¼ï¼Œå»ºè®®ä½¿ç”¨ 512Ã—512 æˆ–æ›´å¤§å°ºå¯¸</div>
    </div>

    <div class="preview-grid" id="previewGrid"></div>

    <button class="button" onclick="generateAndDownloadAll()" id="downloadBtn" style="display: none;">
      ğŸ“¦ æ‰“åŒ…ä¸‹è½½æ‰€æœ‰å›¾æ ‡ (ZIP)
    </button>

    <div class="status" id="status" style="display: none;"></div>

    <div class="instructions">
      <strong>ğŸ“– ä½¿ç”¨è¯´æ˜ï¼š</strong>
      <ol>
        <li>ä¸Šä¼ æ‚¨çš„ SVG å›¾æ ‡æ–‡ä»¶ï¼ˆå»ºè®® 512Ã—512 æˆ–æ›´å¤§ï¼‰</li>
        <li>é¢„è§ˆè‡ªåŠ¨ç”Ÿæˆçš„å„ç§å°ºå¯¸å›¾æ ‡</li>
        <li>ç‚¹å‡»"æ‰“åŒ…ä¸‹è½½æ‰€æœ‰å›¾æ ‡ (ZIP)"ä¸‹è½½å‹ç¼©åŒ…</li>
        <li>è§£å‹ <code>pwa-icons.zip</code> æ–‡ä»¶</li>
        <li>å°†è§£å‹åçš„æ‰€æœ‰ PNG æ–‡ä»¶æ”¾åˆ° <code>public/icons/</code> ç›®å½•</li>
        <li>è¿è¡Œ <code>npm run build && npm run preview</code> æµ‹è¯•</li>
        <li>åœ¨ Safari ä¸­æ‰“å¼€ï¼Œç‚¹å‡»åˆ†äº«æŒ‰é’®ï¼Œé€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"</li>
      </ol>
    </div>
  </div>

  <script>
    const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
    let canvases = {};
    let uploadedSvg = null;

    // å¤„ç†æ‹–æ”¾
    const uploadArea = document.getElementById('uploadArea');

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');

      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type === 'image/svg+xml') {
        handleFile(files[0]);
      } else {
        showStatus('âŒ è¯·ä¸Šä¼  SVG æ ¼å¼çš„æ–‡ä»¶', 'error');
      }
    });

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        handleFile(file);
      }
    }

    function handleFile(file) {
      if (!file.type.includes('svg')) {
        showStatus('âŒ è¯·ä¸Šä¼  SVG æ ¼å¼çš„æ–‡ä»¶', 'error');
        return;
      }

      showStatus('â³ æ­£åœ¨åŠ è½½ SVG æ–‡ä»¶...');

      const reader = new FileReader();
      reader.onload = (e) => {
        const svgData = e.target.result;
        loadSvgAndGenerateIcons(svgData);
      };
      reader.readAsText(file);
    }

    function loadSvgAndGenerateIcons(svgData) {
      // åˆ›å»ºå›¾ç‰‡å¯¹è±¡
      const img = new Image();
      const blob = new Blob([svgData], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);

      img.onload = () => {
        uploadedSvg = img;
        URL.revokeObjectURL(url);
        previewIcons();
        document.getElementById('downloadBtn').style.display = 'block';
      };

      img.onerror = () => {
        URL.revokeObjectURL(url);
        showStatus('âŒ SVG æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
      };

      img.src = url;
    }

    function createIconFromSvg(size) {
      if (!uploadedSvg) {
        showStatus('âŒ è¯·å…ˆä¸Šä¼  SVG æ–‡ä»¶', 'error');
        return null;
      }

      const canvas = document.createElement('canvas');
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, size, size);

      // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼Œä¿æŒå®½é«˜æ¯”
      const scale = Math.min(size / uploadedSvg.width, size / uploadedSvg.height);
      const x = (size - uploadedSvg.width * scale) / 2;
      const y = (size - uploadedSvg.height * scale) / 2;

      // ç»˜åˆ¶ SVG
      ctx.drawImage(uploadedSvg, x, y, uploadedSvg.width * scale, uploadedSvg.height * scale);

      return canvas;
    }

    function previewIcons() {
      if (!uploadedSvg) {
        showStatus('âŒ è¯·å…ˆä¸Šä¼  SVG æ–‡ä»¶', 'error');
        return;
      }

      const grid = document.getElementById('previewGrid');
      grid.innerHTML = '';
      canvases = {};

      sizes.forEach(size => {
        const canvas = createIconFromSvg(size);
        if (!canvas) return;

        canvases[size] = canvas;

        const item = document.createElement('div');
        item.className = 'preview-item';
        item.innerHTML = `<span>${size}Ã—${size}</span>`;
        item.insertBefore(canvas, item.firstChild);

        grid.appendChild(item);
      });

      showStatus('âœ… é¢„è§ˆå·²ç”Ÿæˆï¼ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¸‹è½½æ‰€æœ‰å›¾æ ‡ã€‚', 'success');
    }

    function canvasToBlob(canvas) {
      return new Promise((resolve) => {
        canvas.toBlob((blob) => {
          resolve(blob);
        });
      });
    }

    async function generateAndDownloadAll() {
      if (!uploadedSvg) {
        showStatus('âŒ è¯·å…ˆä¸Šä¼  SVG æ–‡ä»¶', 'error');
        return;
      }

      try {
        showStatus('â³ æ­£åœ¨ç”Ÿæˆå›¾æ ‡...è¯·ç¨å€™');

        // åˆ›å»º ZIP å¯¹è±¡
        const zip = new JSZip();

        // å¦‚æœè¿˜æ²¡é¢„è§ˆï¼Œå…ˆç”Ÿæˆ canvas
        if (Object.keys(canvases).length === 0) {
          sizes.forEach(size => {
            const canvas = createIconFromSvg(size);
            if (canvas) {
              canvases[size] = canvas;
            }
          });
        }

        // å°†æ‰€æœ‰å›¾æ ‡æ·»åŠ åˆ° ZIP
        for (let i = 0; i < sizes.length; i++) {
          const size = sizes[i];
          if (canvases[size]) {
            showStatus(`ğŸ“¦ æ­£åœ¨æ‰“åŒ… ${i + 1}/${sizes.length + 1}: icon-${size}x${size}.png`);
            const blob = await canvasToBlob(canvases[size]);
            zip.file(`icon-${size}x${size}.png`, blob);
          }
        }

        // æ·»åŠ  apple-touch-icon
        showStatus(`ğŸ“¦ æ­£åœ¨æ‰“åŒ… ${sizes.length + 1}/${sizes.length + 1}: apple-touch-icon.png`);
        const appleIcon = createIconFromSvg(180);
        if (appleIcon) {
          const appleBlob = await canvasToBlob(appleIcon);
          zip.file('apple-touch-icon.png', appleBlob);
        }

        // ç”Ÿæˆ ZIP æ–‡ä»¶
        showStatus('â³ æ­£åœ¨å‹ç¼©æ–‡ä»¶...');
        const zipBlob = await zip.generateAsync({
          type: 'blob',
          compression: 'DEFLATE',
          compressionOptions: { level: 9 }
        });

        // ä¸‹è½½ ZIP æ–‡ä»¶
        const url = URL.createObjectURL(zipBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'pwa-icons.zip';
        a.click();
        URL.revokeObjectURL(url);

        showStatus('âœ… å›¾æ ‡å·²æ‰“åŒ…ä¸‹è½½å®Œæˆï¼è¯·è§£å‹åå°†æ–‡ä»¶æ”¾åˆ° public/icons/ ç›®å½•', 'success');
      } catch (error) {
        showStatus('âŒ æ‰“åŒ…å¤±è´¥ï¼š' + error.message, 'error');
        console.error('æ‰“åŒ…é”™è¯¯ï¼š', error);
      }
    }

    function showStatus(message, type = '') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = 'status ' + type;
      status.style.display = 'block';
    }
  </script>
</body>
</html>
